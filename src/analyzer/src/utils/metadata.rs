use serde_json::json;
use std::path::PathBuf;

#[derive(Debug, Clone)]
pub struct MetaData {
    pub proper_trace_count: usize,
    pub path_unsat_trace_count: usize,
    pub branch_explored_trace_count: usize,
    pub duplicate_trace_count: usize,
    pub no_target_trace_count: usize,
    pub exceeding_length_trace_count: usize,
    pub timeout_trace_count: usize,
    pub unreachable_trace_count: usize,
    pub explored_trace_count: usize,
}

impl MetaData {
    pub fn new() -> Self {
        MetaData {
            proper_trace_count: 0,
            path_unsat_trace_count: 0,
            branch_explored_trace_count: 0,
            duplicate_trace_count: 0,
            no_target_trace_count: 0,
            exceeding_length_trace_count: 0,
            timeout_trace_count: 0,
            unreachable_trace_count: 0,
            explored_trace_count: 0,
        }
    }

    pub fn combine(self, other: Self) -> Self {
        MetaData {
            proper_trace_count: self.proper_trace_count + other.proper_trace_count,
            path_unsat_trace_count: self.path_unsat_trace_count + other.path_unsat_trace_count,
            branch_explored_trace_count: self.branch_explored_trace_count + other.branch_explored_trace_count,
            duplicate_trace_count: self.duplicate_trace_count + other.duplicate_trace_count,
            no_target_trace_count: self.no_target_trace_count + other.no_target_trace_count,
            exceeding_length_trace_count: self.exceeding_length_trace_count + other.exceeding_length_trace_count,
            timeout_trace_count: self.timeout_trace_count + other.timeout_trace_count,
            unreachable_trace_count: self.unreachable_trace_count + other.unreachable_trace_count,
            explored_trace_count: self.explored_trace_count + other.explored_trace_count,
        }
    }

    pub fn incr_proper(&mut self) {
        self.proper_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_path_unsat(&mut self) {
        self.path_unsat_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_branch_explored(&mut self) {
        self.branch_explored_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_duplicated(&mut self) {
        self.duplicate_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_no_target(&mut self) {
        self.no_target_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_exceeding_length(&mut self) {
        self.exceeding_length_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_timeout(&mut self) {
        self.timeout_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn incr_unreachable(&mut self) {
        self.unreachable_trace_count += 1;
        self.explored_trace_count += 1;
    }

    pub fn dump(&self, filename: PathBuf) -> Result<(), String> {
        crate::utils::dump_json(
            &json!({
                "proper_trace_count": self.proper_trace_count,
                "path_unsat_trace_count": self.path_unsat_trace_count,
                "branch_explored_trace_count": self.branch_explored_trace_count,
                "duplicate_trace_count": self.duplicate_trace_count,
                "no_target_trace_count": self.no_target_trace_count,
                "exceeding_length_trace_count": self.exceeding_length_trace_count,
                "timeout_trace_count": self.timeout_trace_count,
                "unreachable_trace_count": self.unreachable_trace_count,
                "explored_trace_count": self.explored_trace_count,
            }),
            filename,
        )
    }
}
